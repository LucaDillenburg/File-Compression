package compactador;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.RandomAccessFile;
import java.util.Arrays;

import compactadorArquivo.*;

public class Compactador
{
	public static final String STR_FINAL_ARQ = " - Compactado";
	
	//compactar
	public static void compactar(File arquivo) throws Exception
	{
		if (arquivo == null)
			throw new FileNotFoundException("Arquivo nulo");
		
		if(!arquivo.isDirectory())
		{
			CompactadorArquivo compactadorArq = new CompactadorArquivo();
			compactadorArq.compactar(arquivo);
		}else
		{
			String diretorio = arquivo.getCanonicalPath().substring(0, 
					arquivo.getCanonicalPath().lastIndexOf('.')) + STR_FINAL_ARQ;
			String extensao = arquivo.getName().substring(
					arquivo.getName().lastIndexOf(".")+1);
			
			String nomeArq = diretorio + "." + extensao;
			int n = 1;
			while (new File(nomeArq).exists()) {
				//se jah existe esse arquivo criar outro com " (1)" na frente
				nomeArq = diretorio + " (" + n + ")." + extensao;
				n++;
			}
			
			Compactador.compactarAux(arquivo, nomeArq);
		}
	}
	
	public static void compactar(String nomeArquivo) throws Exception
	{
		if(!new File(nomeArquivo).exists())
			throw new FileNotFoundException("Arquivo inexistente!");

		Compactador.compactar(new File(nomeArquivo));
	}
	
	protected static void compactarAux(File arquivo, String nomeArq)
	{
		if(!arquivo.isDirectory())
		{
			CompactadorArquivo compactadorArq = new CompactadorArquivo();

			try
			{
				compactadorArq.compactar(arquivo, nomeArq);
			}catch (Exception e) {e.printStackTrace();}
		}else
		{
			for (final File arq : arquivo.listFiles())
			{
				try {
					Compactador.compactarAux(arq, arquivo.getCanonicalPath());
				} catch (IOException e) {e.printStackTrace();}
		    }
		}
	}
	
	//compactar
	public static void descompactar(File arquivo) throws Exception
	{
		if (arquivo == null)
			throw new FileNotFoundException("Arquivo nulo");
		
		if(!arquivo.isDirectory())
		{
			CompactadorArquivo compactadorArq = new CompactadorArquivo();
			compactadorArq.descompactar(arquivo);
		}else
		{
			String diretorio = arquivo.getCanonicalPath().substring(0, 
					arquivo.getCanonicalPath().lastIndexOf('.'));
			String extensao = arquivo.getName().substring(
					arquivo.getName().lastIndexOf(".")+1);
			
			int indComp = diretorio.indexOf(" - Compactado");
			if(indComp < 0)
				throw new Exception("Essa pasta ainda não foi compactada!");
			
			diretorio = diretorio.substring(0, indComp);
			
			String nomeArq = diretorio + "." + extensao;
			int n = 1;
			while (new File(nomeArq).exists()) {
				//se jah existe esse arquivo criar outro com " (1)" na frente
				nomeArq = diretorio + " (" + n + ")." + extensao;
				n++;
			}
			
			Compactador.descompactarAux(arquivo, nomeArq);
		}
	}
	
	public static void descompactar(String nomeArquivo) throws Exception
	{
		if(!new File(nomeArquivo).exists())
			throw new FileNotFoundException("Arquivo inexistente!");

		Compactador.descompactar(new File(nomeArquivo));
	}
	
	protected static void descompactarAux(File arquivo, String nomeArq)
	{
		if(!arquivo.isDirectory())
		{
			CompactadorArquivo compactadorArq = new CompactadorArquivo();

			try
			{
				compactadorArq.descompactar(arquivo, nomeArq);
			}catch (Exception e) {e.printStackTrace();}
		}else
		{
			for (final File arq : arquivo.listFiles())
			{
				try {
					Compactador.descompactarAux(arq, arquivo.getCanonicalPath());
				} catch (IOException e) {e.printStackTrace();}
		    }
		}
	}
}